<!DOCTYPE html>
<html>
<head>
<meta charset=utf-8 />
<title>Slideshow gallery in a marker tooltip</title>
<meta name='viewport' content='initial-scale=1,maximum-scale=1,user-scalable=no' />
<script src='https://api.mapbox.com/mapbox.js/v2.2.2/mapbox.js'></script>
<link href='https://api.mapbox.com/mapbox.js/v2.2.2/mapbox.css' rel='stylesheet' />
<style>
  body { margin:0; padding:0; }
  #map { position:absolute; top:0; bottom:0; width:100%; }
</style>
</head>
<body>


<style>
.popup {
  text-align:center;
  }
.popup .slideshow .image        { display:none; }
.popup .slideshow .image.active { display:block; }
.popup .slideshow img {
  width:100%;
  }
.popup .slideshow .caption {
  background:#eee;
  padding:10px;
  }
.popup .cycle {
  padding:10px 0 20px;
  }
  .popup .cycle a.prev { float:left; }
  .popup .cycle a.next { float:right; }
</style>

<div id='map'></div>

<!-- jQuery is required for this example. -->
<script src='https://code.jquery.com/jquery-1.11.0.min.js'></script>
<script>
L.mapbox.accessToken = 'pk.eyJ1IjoiY2xldmVsYW5kLW1ldHJvcGFya3MiLCJhIjoiWHRKaDhuRSJ9.FGqNSOHwiCr2dmTH2JTMAA';
var map = L.mapbox.map('map', 'mapbox.outdoors');

var myLayer = L.mapbox.featureLayer().addTo(map);

var geoJson = [{
  "type": "FeatureCollection",
  "features": [
    {
      "type": "Feature",
      "properties": {
        "title": "West Creek Watershed Stewardship Center",
        "marker-color": "#7e7e7e",
        "marker-size": "medium",
        "marker-symbol": "park",
		"images":[
          ['imgs/wc1.JPG','Gayle Albers leading the tour through the Watershed Stewardship Center.']
        ]
      },
      "geometry": {
        "type": "Point",
        "coordinates": [
          -81.69534713029861,
          41.38968839401559
        ]
      }
    },
    {
      "type": "Feature",
      "properties": {
        "marker-color": "#7e7e7e",
        "marker-size": "medium",
        "marker-symbol": "park",
        "title": "Squaw Rock",
        "images":[
          ['imgs/sr1.JPG','A look down the staircase leading to Squaw Rock.'],
          ['imgs/sr2.JPG','The hike provided excellent views of the Chagrin River.'],
		  ['imgs/sr3.JPG','Priscila Rocha and Christine Steiger enjoying the views along the river.'],
		  ['imgs/sr4.JPG','Stefanie Verish leading the hike to Squaw Rock, stopping to talk about some of the unique plants found along the trail.'],
		  ['imgs/sr5.JPG','Some hikers ventured out near the water to get a better look at the carvings found on Squaw Rock.'],
		  ['imgs/sr6.JPG','James Holt down on the river-facing side of Squaw Rock.'],
		  ['imgs/sr7.JPG','Bethany Croskey taking in the view from atop Squaw Rock.'],
		  ['imgs/sr8.JPG','Lisa Fellows-Bobbitt getting her hands on some peppermint fungus.']
        ]
      },
      "geometry": {
        "type": "Point",
        "coordinates": [
          -81.41539961099625,
          41.412907898672835
        ]
      }
    },
    {
      "type": "Feature",
      "properties": {
        "title": "Look About Lodge",
        "marker-color": "#7e7e7e",
        "marker-size": "medium",
        "marker-symbol": "park",
		"images":[
          ['imgs/lal1.JPG','Naturalist Stefanie Verish discussing the history of Look About Lodge.'],
          ['imgs/lal2.JPG','Bryan stops by for lunch and takes questions from the group.']
        ]
      },
      "geometry": {
        "type": "Point",
        "coordinates": [
          -81.42151236534119,
          41.42349385001758
        ]
      }
    },
    {
      "type": "Feature",
      "properties": {
        "title": "Acacia Reservation",
        "marker-color": "#7e7e7e",
        "marker-size": "medium",
        "marker-symbol": "park",
		"images":[
          ['imgs/ac1.JPG','Director of Natural Resources, Terry Robison discussing Acacia Reservation and future plans for the site.'],
          ['imgs/ac2.JPG','Terry talking about the challenges of turning a golf course back into a native forest.'],
		  ['imgs/ac3.JPG','What was once a fairway is now beginning to revert to an unmaintained meadow.'],
		  ['imgs/ac4.JPG','Euclid Creek, which runs through Acacia, is set to undergo restoration over the coming years.']
        ]
      },
      "geometry": {
        "type": "Point",
        "coordinates": [
          -81.48945271968842,
          41.501988788015815
        ]
      }
    },
    {
      "type": "Feature",
      "properties": {
        "title": "North Chagrin Nature Center",
        "marker-color": "#7e7e7e",
        "marker-size": "medium",
        "marker-symbol": "park",
		"images":[
          ['imgs/nc1.JPG','Kyle Baker making new friends while on the tour.'],
          ['imgs/nc2.JPG','Catching a glimpse of the wildlife found in Sanctuary Marsh.']
        ]
      },
      "geometry": {
        "type": "Point",
        "coordinates": [
          -81.43587827682495,
          41.56169875069485
        ]
      }
    },
    {
      "type": "Feature",
      "properties": {
        "title": "Nature Education Building",
        "marker-color": "#7e7e7e",
        "marker-size": "medium",
        "marker-symbol": "park",
		"images":[
          ['imgs/ed1.JPG','Selby Majewski brings out one of the owls housed at the Nature Education Building at North Chagrin.'],
          ['imgs/ed2.JPG','Selby answering questions on why the owls are housed at the Nature Education Building.']
        ]
      },
      "geometry": {
        "type": "Point",
        "coordinates": [
          -81.43689215183258,
          41.56235100314951
        ]
      }
    },
    {
      "type": "Feature",
      "properties": {
        "title": "Squires Castle",
        "marker-color": "#7e7e7e",
        "marker-size": "medium",
        "marker-symbol": "park",
		"images": [
          ['imgs/sq1.JPG','Lieutenant Robert Pofok discussing what the Rangers do and taking questions.'],
          ['imgs/sq2.JPG','The first time many on the tour have been to Squires Castle.']
        ]
      },
      "geometry": {
        "type": "Point",
        "coordinates": [
          -81.41924858093262,
          41.58001149644672
        ]
      }
    },
    {
      "type": "Feature",
      "properties": {
        "title": "Zoo",
        "marker-color": "#7e7e7e",
        "marker-size": "medium",
        "marker-symbol": "park",
        "images": "null"
      },
      "geometry": {
        "type": "Point",
        "coordinates": [
          -81.71162277460098,
          41.44723606714426
        ]
      }
    }
  ]
}];



// Add custom popup html to each marker.
myLayer.on('layeradd', function(e) {
    var marker = e.layer;
    var feature = marker.feature;
    var images = feature.properties.images
    var slideshowContent = '';

    for(var i = 0; i < images.length; i++) {
        var img = images[i];

        slideshowContent += '<div class="image' + (i === 0 ? ' active' : '') + '">' +
                              '<img src="' + img[0] + '" />' +
                              '<div class="caption">' + img[1] + '</div>' +
                            '</div>';
    }

    // Create custom popup content
    var popupContent =  '<div id="' + feature.properties.id + '" class="popup">' +
                            '<h2>' + feature.properties.title + '</h2>' +
                            '<div class="slideshow">' +
                                slideshowContent +
                            '</div>' +
                            '<div class="cycle">' +
                                '<a href="#" class="prev">&laquo; Previous</a>' +
                                '<a href="#" class="next">Next &raquo;</a>' +
                            '</div>'
                        '</div>';

    // http://leafletjs.com/reference.html#popup
    marker.bindPopup(popupContent,{
        closeButton: false,
        minWidth: 320
    });
});

// Add features to the map
myLayer.setGeoJSON(geoJson);

$('#map').on('click', '.popup .cycle a', function() {
    var $slideshow = $('.slideshow'),
        $newSlide;

    if ($(this).hasClass('prev')) {
        $newSlide = $slideshow.find('.active').prev();
        if ($newSlide.index() < 0) {
            $newSlide = $('.image').last();
        }
    } else {
        $newSlide = $slideshow.find('.active').next();
        if ($newSlide.index() < 0) {
            $newSlide = $('.image').first();
        }
    }

    $slideshow.find('.active').removeClass('active').hide();
    $newSlide.addClass('active').show();
    return false;
});

map.setView([41.3902, -81.6682], 11);
</script>


</body>
</html>
